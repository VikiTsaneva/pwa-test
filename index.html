<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Parkly - Намерете свободни паркоместа</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple touch icons за iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Parkly">
    
    <!-- Theme color -->
    <meta name="theme-color" content="#2c3e50">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Светла тема (по подразбиране) */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-color: #f5f5f5;
            --text-color: #333333;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ffffff;
            --border-color: #e9ecef;
            --input-bg: #ffffff;
            --input-border: #e9ecef;
            --stat-bg: #f8f9fa;
            --hover-bg: rgba(0,0,0,0.05);
            --map-title-bg: rgba(255,255,255,0.95);
            --status-panel-bg: rgba(255,255,255,0.98);
            --legend-bg: rgba(255,255,255,0.95);
            --contact-modal-bg: #ffffff;
            --contact-info-bg: #f8f9fa;
            --link-color: #667eea;
            --icon-color: #667eea;
            --status-badge-bg: #eef2f6;
            --status-badge-text: #2c3e50;
        }

        /* Тъмна тема */
        body.dark-theme {
            --primary: #3498db;
            --secondary: #667eea;
            --accent: #e74c3c;
            --light: #2d2d2d;
            --dark: #1a1a1a;
            --success: #27ae60;
            --warning: #f39c12;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --text-secondary: #cccccc;
            --card-bg: #2d2d2d;
            --header-bg: #2d2d2d;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ffffff;
            --border-color: #404040;
            --input-bg: #3d3d3d;
            --input-border: #404040;
            --stat-bg: #363636;
            --hover-bg: rgba(255,255,255,0.1);
            --map-title-bg: rgba(45,45,45,0.95);
            --status-panel-bg: rgba(45,45,45,0.98);
            --legend-bg: rgba(45,45,45,0.95);
            --contact-modal-bg: #2d2d2d;
            --contact-info-bg: #363636;
            --link-color: #667eea;
            --icon-color: #667eea;
            --status-badge-bg: #404040;
            --status-badge-text: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Сайдбар */
        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, background-color 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .sidebar-header {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            color: white;
        }

        .sidebar-header .logo-icon {
            margin-right: 12px;
            vertical-align: middle;
            display: inline-block;
            background: transparent;
            filter: none;
        }

        .sidebar-header img.logo-icon {
            width: 96px;
            height: 96px;
            object-fit: contain;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            image-rendering: optimizeQuality;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25));
        }

        .sidebar-header i.logo-icon {
            font-size: 2.4rem;
            color: var(--secondary);
            line-height: 1;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            color: var(--sidebar-text);
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--secondary);
        }

        .nav-item i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
            color: var(--secondary);
        }

        .user-info {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
        }

        .user-name {
            color: white;
        }

        .user-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Основно съдържание */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .header {
            background-color: var(--header-bg);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .header h1 {
            color: var(--primary);
            font-size: 1.8rem;
            transition: color 0.3s ease;
        }

        .search-bar {
            display: flex;
            width: 300px;
        }

        .search-bar input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--input-border);
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .search-bar input::placeholder {
            color: var(--text-secondary);
        }

        .search-bar button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-bar button:hover {
            background-color: var(--primary);
        }

        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
            height: 100%;
        }

        /* Страници */
        .page {
            display: none;
            height: 100%;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Карта - стилове от вашия код */
        #map {
            height: 100%;
            width: 100%;
            background: #c8e0f0;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .map-container {
            height: 100%;
            position: relative;
        }

        /* Заглавие на картата */
        .map-title {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--map-title-bg);
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            text-align: left;
            min-width: 280px;
            backdrop-filter: blur(8px);
            border-left: 5px solid var(--secondary);
            pointer-events: none;
            transition: background-color 0.3s ease;
        }
        
        .map-title h2 {
            color: var(--text-color);
            font-size: 1.4rem;
            margin-bottom: 4px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }
        
        .map-title h2 i {
            color: var(--secondary);
        }
        
        .map-title p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s ease;
        }
        
        .map-title p i {
            color: var(--success);
            font-size: 14px;
        }
        
        /* Статус панел */
        .status-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--status-panel-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            z-index: 1000;
            min-width: 260px;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            pointer-events: none;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .status-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .status-title i {
            color: var(--secondary);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.2s;
        }
        
        .spot-number {
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }
        
        .spot-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 10px;
            background: var(--status-badge-bg);
            color: var(--status-badge-text);
            font-weight: 700;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .disabled-badge {
            background: rgba(52, 152, 219, 0.2);
            color: var(--secondary);
        }
        
        .disabled-badge i {
            font-size: 14px;
        }
        
        .status-value {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            padding: 4px 12px;
            border-radius: 30px;
        }
        
        .status-value i {
            font-size: 12px;
        }
        
        .status-empty {
            background: rgba(39, 174, 96, 0.15);
            color: var(--success);
        }
        
        .status-occupied {
            background: rgba(231, 76, 60, 0.15);
            color: var(--accent);
        }
        
        .status-disabled-empty {
            background: rgba(52, 152, 219, 0.15);
            color: var(--secondary);
        }
        
        .status-disabled-occupied {
            background: rgba(231, 76, 60, 0.15);
            color: var(--accent);
        }
        
        .status-pending {
            background: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }
        
        .last-update {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .last-update i {
            color: var(--secondary);
            font-size: 12px;
        }
        
        /* Долен панел с информация */
        .info-footer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            pointer-events: none;
        }
        
        .parking-stats {
            background: var(--status-panel-bg);
            padding: 12px 20px;
            border-radius: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            backdrop-filter: blur(8px);
            pointer-events: auto;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item i {
            font-size: 1.1rem;
            color: var(--secondary);
        }
        
        .stat-item .label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }
        
        .stat-item .value {
            font-weight: 700;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        .controls {
            background: var(--status-panel-bg);
            padding: 8px;
            border-radius: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            pointer-events: auto;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .controls button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 40px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .controls button:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .controls button i {
            font-size: 1rem;
        }
        
        /* Легенда */
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: var(--legend-bg);
            padding: 12px 16px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 0.85rem;
            backdrop-filter: blur(8px);
            pointer-events: auto;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        .legend-item:last-child {
            margin-bottom: 0;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
        }
        
        .legend-color.blue {
            background: var(--secondary);
            opacity: 0.7;
        }
        
        .legend-color.green {
            background: var(--success);
            opacity: 0.7;
        }
        
        .legend-color.red {
            background: var(--accent);
            opacity: 0.7;
        }

        /* Стилове за профил */
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .profile-header {
            background: var(--bg-gradient);
            padding: 30px;
            color: white;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            border: 4px solid rgba(255,255,255,0.3);
        }

        .profile-header-info h2 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: white;
        }

        .profile-header-info p {
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 30px;
            background: var(--stat-bg);
            transition: background-color 0.3s ease;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .stat-card i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .stat-card .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .stat-card .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .profile-details {
            padding: 30px;
        }

        .profile-details h3 {
            margin-bottom: 20px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s ease;
        }

        .profile-details h3 i {
            color: var(--secondary);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-item label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .detail-item .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            padding: 10px;
            background: var(--stat-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .edit-profile-btn {
            background: var(--bg-gradient);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .edit-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Бутони */
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn i {
            margin-right: 8px;
        }

        /* Стилове за вход */
        .auth-container {
            max-width: 450px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .auth-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .auth-header i {
            font-size: 3rem;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.2);
            width: 80px;
            height: 80px;
            line-height: 80px;
            border-radius: 50%;
            display: inline-block;
        }

        .auth-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: white;
        }

        .auth-header p {
            color: rgba(255,255,255,0.9);
        }

        .auth-form {
            padding: 30px;
        }

        .auth-form .form-group {
            margin-bottom: 20px;
        }

        .auth-form .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .auth-form .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .auth-form .form-group input::placeholder {
            color: var(--text-secondary);
        }

        .auth-form .form-group input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .auth-links {
            text-align: center;
            margin-top: 20px;
        }

        .auth-links a {
            color: var(--link-color);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-color);
            transition: border-color 0.3s ease;
        }

        .auth-divider span {
            padding: 0 10px;
        }

        .social-login {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--input-bg);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.3rem;
            color: var(--text-color);
        }

        .social-btn:hover {
            transform: translateY(-2px);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Стилове за регистрация */
        .register-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .register-header i {
            font-size: 3rem;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.2);
            width: 80px;
            height: 80px;
            line-height: 80px;
            border-radius: 50%;
            display: inline-block;
        }

        .register-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: white;
        }

        .register-header p {
            color: rgba(255,255,255,0.9);
        }

        .register-form {
            padding: 30px;
        }

        .register-form .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .register-form .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .register-form .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .register-form .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .register-form .form-group input::placeholder {
            color: var(--text-secondary);
        }

        .register-form .form-group input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .terms-checkbox input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .terms-checkbox label {
            color: var(--text-color);
            transition: color 0.3s ease;
            font-size: 0.95rem;
        }

        .terms-checkbox a {
            color: var(--link-color);
            text-decoration: none;
        }

        /* Списъци */
        .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .favorite-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .favorite-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .favorite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .favorite-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .favorite-card p {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .favorite-card p i {
            color: var(--secondary);
            margin-right: 8px;
        }

        .favorite-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-free {
            background-color: rgba(39, 174, 96, 0.15);
            color: var(--success);
        }

        .status-busy {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--accent);
        }

        /* Настройки */
        .settings-list {
            background-color: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .setting-item {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.3s ease;
            flex-wrap: wrap;
            gap: 15px;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
            min-width: 200px;
        }

        .setting-info h4 {
            color: var(--text-color);
            margin-bottom: 5px;
            transition: color 0.3s ease;
            font-size: 1.1rem;
        }

        .setting-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--secondary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        select {
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
            cursor: pointer;
            min-width: 120px;
        }

        select option {
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        /* Балонче за контакти */
        .contact-bubble {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            z-index: 2000;
            animation: pulse 2s infinite;
        }

        .contact-bubble:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            animation: none;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            }
            50% {
                box-shadow: 0 5px 30px rgba(0,0,0,0.8);
            }
            100% {
                box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            }
        }

        /* Модален прозорец за контакти */
        .contact-modal {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            background: var(--contact-modal-bg);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 2001;
            display: none;
            overflow: hidden;
            animation: slideIn 0.3s ease;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .contact-modal.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .modal-header h3 i {
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 20px;
        }

        .contact-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .contact-form textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .contact-form textarea::placeholder {
            color: var(--text-secondary);
        }

        .contact-form textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .contact-info {
            background: var(--contact-info-bg);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            transition: background-color 0.3s ease;
        }

        .contact-info p {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .contact-info p:last-child {
            margin-bottom: 0;
        }

        .contact-info i {
            color: var(--secondary);
            width: 20px;
        }

        /* Инсталационен банер за PWA */
        .install-banner {
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 16px;
            display: none;
            align-items: center;
            justify-content: space-between;
            z-index: 3000;
            border: 1px solid var(--border-color);
            max-width: 400px;
            margin: 0 auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .install-banner-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .install-banner-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
        }

        .install-banner-text h4 {
            color: var(--text-color);
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .install-banner-text p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .install-banner-actions {
            display: flex;
            gap: 8px;
        }

        .install-banner-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .install-banner-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Мобилна версия */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
            }
            
            .container {
                flex-direction: column;
                overflow-y: auto;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                min-height: 60px;
                flex-direction: row;
                position: relative;
                z-index: 100;
            }
            
            .sidebar-header {
                padding: 10px 15px;
                border-bottom: none;
                border-right: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
            }
            
            .sidebar-header h2 {
                font-size: 1rem;
            }
            
            .sidebar-header .logo-icon {
                font-size: 1rem;
            }
            
            .nav-menu {
                display: flex;
                padding: 0;
                flex: 1;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            
            .nav-menu::-webkit-scrollbar {
                display: none;
            }
            
            .nav-item {
                flex: 0 0 auto;
                justify-content: center;
                padding: 0 12px;
                border-left: none;
                border-bottom: 3px solid transparent;
                min-width: 50px;
            }
            
            .nav-item:hover, .nav-item.active {
                border-left-color: transparent;
                border-bottom-color: var(--secondary);
            }
            
            .nav-item span {
                display: none;
            }
            
            .nav-item i {
                margin-right: 0;
                font-size: 1.3rem;
            }
            
            .user-info {
                display: none;
            }
            
            .header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .header h1 {
                font-size: 1.3rem;
                text-align: center;
            }
            
            .search-bar {
                width: 100%;
            }
            
            .content-area {
                padding: 10px;
                height: calc(100vh - 120px);
                overflow-y: auto;
            }
            
            /* Карта на мобилно */
            .map-container {
                height: 80vh;
                position: relative;
            }
            
            .map-title {
                top: 10px;
                left: 10px;
                right: 10px;
                min-width: auto;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .map-title h2 {
                font-size: 1.1rem;
            }
            
            .map-title p {
                font-size: 0.8rem;
            }
            
            .status-panel {
                position: relative;
                top: auto;
                right: auto;
                left: auto;
                margin-top: 15px;
                width: 100%;
                min-width: auto;
                pointer-events: auto;
            }
            
            .info-footer {
                position: relative;
                bottom: auto;
                left: auto;
                right: auto;
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }
            
            .parking-stats {
                width: 100%;
                justify-content: space-around;
                padding: 10px;
            }
            
            .controls {
                width: 100%;
            }
            
            .controls button {
                width: 100%;
                justify-content: center;
            }
            
            .legend {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 15px;
                width: 100%;
            }
            
            /* Профил на мобилно */
            .profile-header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
                gap: 15px;
            }
            
            .profile-avatar-large {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }
            
            .profile-header-info h2 {
                font-size: 1.5rem;
            }
            
            .profile-stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 20px;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .profile-details {
                padding: 20px;
            }
            
            /* Форми на мобилно */
            .auth-container,
            .register-container,
            .profile-container {
                margin: 10px;
                width: calc(100% - 20px);
                overflow-y: auto;
            }
            
            .register-form .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .register-form .form-row .form-group {
                width: 100%;
            }
            
            /* Настройки на мобилно */
            .settings-list {
                overflow-y: auto;
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .setting-info {
                width: 100%;
            }
            
            .toggle-switch {
                align-self: flex-start;
            }
            
            select {
                width: 100%;
                min-width: auto;
            }
            
            /* Любими места на мобилно */
            .favorites-list {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .favorite-card {
                padding: 15px;
            }
            
            .favorite-name {
                font-size: 1.1rem;
            }
            
            /* Контакти на мобилно */
            .contact-modal {
                width: calc(100% - 20px);
                right: 10px;
                left: 10px;
                bottom: 80px;
            }
            
            .contact-bubble {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .install-banner {
                bottom: 80px;
                left: 10px;
                right: 10px;
                max-width: none;
            }
            
            .terms-checkbox {
                align-items: flex-start;
            }
            
            .terms-checkbox input {
                margin-top: 3px;
            }
            
            .terms-checkbox label {
                font-size: 0.9rem;
                flex: 1;
            }
        }

        /* Много малки екрани */
        @media (max-width: 380px) {
            .sidebar-header h2 {
                font-size: 0.9rem;
            }
            
            .nav-item i {
                font-size: 1.1rem;
            }
            
            .map-title {
                padding: 8px 12px;
            }
            
            .map-title h2 {
                font-size: 1rem;
            }
            
            .map-title p {
                font-size: 0.75rem;
            }
            
            .stat-item {
                font-size: 0.8rem;
            }
            
            .stat-item i {
                font-size: 0.9rem;
            }
            
            .status-item {
                font-size: 0.85rem;
            }
            
            .spot-badge {
                width: 24px;
                height: 24px;
                font-size: 0.8rem;
            }
        }

        /* Езикова поддръжка - скриване на елементи според езика */
        [data-lang="bg"] .lang-en {
            display: none !important;
        }

        [data-lang="en"] .lang-bg {
            display: none !important;
        }

        /* Language switching is handled via JavaScript - no CSS needed */
    </style>
</head>
<body data-lang="bg">
    <div class="container">
        <!-- Сайдбар с навигация -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-parking logo-icon"></i> <span class="lang-bg">Parkly</span><span class="lang-en">Parkly</span></h2>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" data-page="map">
                    <i class="fas fa-map"></i>
                    <span class="lang-bg">Карта на паркингите</span>
                    <span class="lang-en">Parking Map</span>
                </div>
                <div class="nav-item" data-page="favorites">
                    <i class="fas fa-star"></i>
                    <span class="lang-bg">Любими места</span>
                    <span class="lang-en">Favorites</span>
                </div>
                <div class="nav-item" data-page="profile">
                    <i class="fas fa-user-circle"></i>
                    <span class="lang-bg">Моят профил</span>
                    <span class="lang-en">My Profile</span>
                </div>
                <div class="nav-item" data-page="login">
                    <i class="fas fa-sign-in-alt"></i>
                    <span class="lang-bg">Вход</span>
                    <span class="lang-en">Login</span>
                </div>
                <div class="nav-item" data-page="register">
                    <i class="fas fa-user-plus"></i>
                    <span class="lang-bg">Регистрация</span>
                    <span class="lang-en">Register</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span class="lang-bg">Настройки</span>
                    <span class="lang-en">Settings</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar"><i class="fas fa-user"></i></div>
                <div>
                    <div class="user-name lang-bg"></div>
                    <div class="user-name lang-en"></div>
                    <div class="user-status lang-bg"></div>
                    <div class="user-status lang-en"></div>
                </div>
            </div>
        </div>
        
        <!-- Основно съдържание -->
        <div class="main-content">
            <div class="header">
                <h1 id="page-title" class="lang-bg">Карта на паркингите</h1>
                <h1 id="page-title" class="lang-en">Parking Map</h1>
                <div class="search-bar">
                    <input type="text" id="search-input" class="lang-bg" placeholder="Търсене на паркинг...">
                    <input type="text" id="search-input" class="lang-en" placeholder="Search parking...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Карта на паркингите -->
                <div id="map-page" class="page active">
                    <div class="map-container">
                        <div id="map"></div>
                        
                        <!-- Хедър на картата -->
                        <div class="map-title">
                            <h2>
                                <i class="fas fa-parking"></i>
                                <span class="lang-bg">ул. "Епископ Софроний"</span>
                                <span class="lang-en">"Ep. Sofroniy" Street</span>
                            </h2>
                            <p>
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="lang-bg">Габрово • 3 паркоместа (1 място за инвалиди)</span>
                                <span class="lang-en">Gabrovo • 3 spots (1 disabled spot)</span>
                            </p>
                        </div>
                        
                        <!-- Статус панел -->
                        <div class="status-panel">
                            <div class="status-title">
                                <i class="fas fa-clipboard-list"></i>
                                <span class="lang-bg">Текущ статус</span>
                                <span class="lang-en">Current Status</span>
                            </div>
                            
                            <div class="status-item" id="spot1-item">
                                <div class="spot-number">
                                    <span class="spot-badge disabled-badge">
                                        <i class="fas fa-wheelchair"></i>
                                    </span>
                                    <span class="lang-bg">Място 1 (инв.)</span>
                                    <span class="lang-en">Spot 1 (disabled)</span>
                                </div>
                                <div>
                                    <span id="status1" class="status-value status-pending">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <span class="lang-bg">Зареждане...</span>
                                        <span class="lang-en">Loading...</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="status-item" id="spot2-item">
                                <div class="spot-number">
                                    <span class="spot-badge">2</span>
                                    <span class="lang-bg">Място 2</span>
                                    <span class="lang-en">Spot 2</span>
                                </div>
                                <div>
                                    <span id="status2" class="status-value status-pending">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <span class="lang-bg">Зареждане...</span>
                                        <span class="lang-en">Loading...</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="status-item">
                                <div class="spot-number">
                                    <span class="spot-badge">3</span>
                                    <span class="lang-bg">Място 3</span>
                                    <span class="lang-en">Spot 3</span>
                                </div>
                                <div>
                                    <span id="status3" class="status-value status-empty">
                                        <i class="fas fa-check-circle"></i>
                                        <span class="lang-bg">СВОБОДНО</span>
                                        <span class="lang-en">FREE</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="last-update">
                                <i class="far fa-clock"></i>
                                <span id="lastUpdate"><span class="lang-bg">Последна актуализация: --</span><span class="lang-en">Last update: --</span></span>
                            </div>
                        </div>
                        
                        <!-- Долен панел -->
                            
                            <div class="controls">
                                <button onclick="manualRefresh()">
                                    <i class="fas fa-sync-alt"></i>
                                    <span class="lang-bg">Актуализирай</span>
                                    <span class="lang-en">Refresh</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Легенда -->
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color blue"></div>
                                <span class="lang-bg">Място за инвалиди</span>
                                <span class="lang-en">Disabled spot</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color green"></div>
                                <span class="lang-bg">Свободно място</span>
                                <span class="lang-en">Free spot</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color red"></div>
                                <span class="lang-bg">Заето място</span>
                                <span class="lang-en">Occupied spot</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Любими места -->
                <div id="favorites-page" class="page">
                    <h2 class="form-title lang-bg">Любими паркинги</h2>
                    <h2 class="form-title lang-en">Favorite Parking Lots</h2>
                    <div class="favorites-list" id="favorites-list">
                        <!-- Динамично ще се генерират -->
                    </div>
                </div>
                
                <!-- Моят профил -->
                <div id="profile-page" class="page">
                    <div class="profile-container">
                        <div class="profile-header">
                            <div class="profile-avatar-large">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="profile-header-info">
                                <h2 class="lang-bg"></h2>
                                <h2 class="lang-en"></h2>
                                <p><i class="fas fa-envelope"></i> </p>
                                <p><i class="fas fa-phone"></i> </p>
                            </div>
                        </div>
                        
                        <div class="profile-details">
                            <h3><i class="fas fa-info-circle"></i> <span class="lang-bg">Лична информация</span><span class="lang-en">Personal Information</span></h3>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label class="lang-bg">Име и фамилия</label>
                                    <label class="lang-en">Full name</label>
                                    <div class="detail-value lang-bg"></div>
                                    <div class="detail-value lang-en"></div>
                                </div>
                                <div class="detail-item">
                                    <label>Email</label>
                                    <div class="detail-value"></div>
                                </div>
                                <div class="detail-item">
                                    <label class="lang-bg">Телефон</label>
                                    <label class="lang-en">Phone</label>
                                    <div class="detail-value"></div>
                                </div>
                                <div class="detail-item">
                                    <label class="lang-bg">Регистрационен номер</label>
                                    <label class="lang-en">License plate</label>
                                    <div class="detail-value"></div>
                                </div>
                                <div class="detail-item">
                                    <label class="lang-bg">Град</label>
                                    <label class="lang-en">City</label>
                                    <div class="detail-value lang-bg"></div>
                                    <div class="detail-value lang-en"></div>
                                </div>
                                <div class="detail-item">
                                    <label class="lang-bg">Адрес</label>
                                    <label class="lang-en">Address</label>
                                    <div class="detail-value lang-bg"></div>
                                    <div class="detail-value lang-en"></div>
                                </div>
                            </div>
                            
                            <button class="edit-profile-btn">
                                <i class="fas fa-edit"></i>
                                <span class="lang-bg">Редактирай профила</span>
                                <span class="lang-en">Edit Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Вход -->
                <div id="login-page" class="page">
                    <div class="auth-container">
                        <div class="auth-header">
                            <i class="fas fa-sign-in-alt"></i>
                            <h2 class="lang-bg">Добре дошли!</h2>
                            <h2 class="lang-en">Welcome!</h2>
                            <p class="lang-bg">Влезте в своя профил</p>
                            <p class="lang-en">Sign in to your account</p>
                        </div>
                        
                        <div class="auth-form">
                            <form id="login-form">
                                <div class="form-group">
                                    <label for="login-email">Email</label>
                                    <input type="email" id="login-email" class="lang-bg" placeholder="your@email.com" required>
                                    <input type="email" id="login-email" class="lang-en" placeholder="your@email.com" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="login-password" class="lang-bg">Парола</label>
                                    <label for="login-password" class="lang-en">Password</label>
                                    <input type="password" id="login-password" class="lang-bg" placeholder="••••••••" required>
                                    <input type="password" id="login-password" class="lang-en" placeholder="••••••••" required>
                                </div>
                                
                                <button type="submit" class="auth-btn">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span class="lang-bg">Вход</span>
                                    <span class="lang-en">Login</span>
                                </button>
                                
                                <div class="auth-links">
                                    <a href="#" class="lang-bg">Забравена парола?</a>
                                    <a href="#" class="lang-en">Forgot password?</a>
                                </div>
                                
                                <div class="auth-divider">
                                    <span class="lang-bg">или</span>
                                    <span class="lang-en">or</span>
                                </div>
                                
                                <div class="social-login">
                                    <button type="button" class="social-btn"><i class="fab fa-google"></i></button>
                                    <button type="button" class="social-btn"><i class="fab fa-facebook-f"></i></button>
                                    <button type="button" class="social-btn"><i class="fab fa-apple"></i></button>
                                </div>
                                
                                <div class="auth-links" style="margin-top: 20px;">
                                    <span class="lang-bg">Нямате профил?</span>
                                    <span class="lang-en">Don't have an account?</span>
                                    <a href="#" onclick="document.querySelector('[data-page=register]').click(); return false;" class="lang-bg">Регистрирайте се</a>
                                    <a href="#" onclick="document.querySelector('[data-page=register]').click(); return false;" class="lang-en">Register</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Регистрация -->
                <div id="register-page" class="page">
                    <div class="register-container">
                        <div class="register-header">
                            <i class="fas fa-user-plus"></i>
                            <h2 class="lang-bg">Създайте профил</h2>
                            <h2 class="lang-en">Create Account</h2>
                            <p class="lang-bg">Присъединете се към Parkly</p>
                            <p class="lang-en">Join Parkly</p>
                        </div>
                        
                        <div class="register-form">
                            <form id="register-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="register-firstname" class="lang-bg">Име *</label>
                                        <label for="register-firstname" class="lang-en">First Name *</label>
                                        <input type="text" id="register-firstname" class="lang-bg"  required>
                                        <input type="text" id="register-firstname" class="lang-en"  required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-lastname" class="lang-bg">Фамилия *</label>
                                        <label for="register-lastname" class="lang-en">Last Name *</label>
                                        <input type="text" id="register-lastname" class="lang-bg"  required>
                                        <input type="text" id="register-lastname" class="lang-en"  required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="register-email">Email *</label>
                                        <input type="email" id="register-email"  required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-phone" class="lang-bg">Телефон *</label>
                                        <label for="register-phone" class="lang-en">Phone *</label>
                                        <input type="tel" id="register-phone"  required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="register-password" class="lang-bg">Парола *</label>
                                        <label for="register-password" class="lang-en">Password *</label>
                                        <input type="password" id="register-password" class="lang-bg"  required>
                                        <input type="password" id="register-password" class="lang-en"  required>
                                    </div>
                                    <div class="form-group">
                                        <label for="register-confirm" class="lang-bg">Потвърдете паролата *</label>
                                        <label for="register-confirm" class="lang-en">Confirm Password *</label>
                                        <input type="password" id="register-confirm" class="lang-bg"  required>
                                        <input type="password" id="register-confirm" class="lang-en"  required>
                                    </div>
                                </div>
                                
                                <div class="terms-checkbox">
                                    <input type="checkbox" id="terms" required>
                                    <label for="terms" class="lang-bg">Съгласявам се с <a href="#">Общите условия</a> и <a href="#">Политиката за поверителност</a></label>
                                    <label for="terms" class="lang-en">I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a></label>
                                </div>
                                
                                <button type="submit" class="auth-btn">
                                    <i class="fas fa-user-check"></i>
                                    <span class="lang-bg">Регистрация</span>
                                    <span class="lang-en">Register</span>
                                </button>
                                
                                <div class="auth-divider">
                                    <span class="lang-bg">или</span>
                                    <span class="lang-en">or</span>
                                </div>
                                
                                <div class="social-login">
                                    <button type="button" class="social-btn"><i class="fab fa-google"></i></button>
                                    <button type="button" class="social-btn"><i class="fab fa-facebook-f"></i></button>
                                    <button type="button" class="social-btn"><i class="fab fa-apple"></i></button>
                                </div>
                                
                                <div class="auth-links" style="margin-top: 20px;">
                                    <span class="lang-bg">Вече имате профил?</span>
                                    <span class="lang-en">Already have an account?</span>
                                    <a href="#" onclick="document.querySelector('[data-page=login]').click(); return false;" class="lang-bg">Вход</a>
                                    <a href="#" onclick="document.querySelector('[data-page=login]').click(); return false;" class="lang-en">Login</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Настройки -->
                <div id="settings-page" class="page">
                    <h2 class="form-title lang-bg">Настройки</h2>
                    <h2 class="form-title lang-en">Settings</h2>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4 class="lang-bg">Тъмна тема</h4>
                                <h4 class="lang-en">Dark theme</h4>
                                <p class="lang-bg">Превключване между светла и тъмна тема на приложението</p>
                                <p class="lang-en">Switch between light and dark theme</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="darkmode-toggle">
                                <label for="darkmode-toggle" class="slider"></label>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4 class="lang-bg">Език</h4>
                                <h4 class="lang-en">Language</h4>
                                <p class="lang-bg">Изберете предпочитан език на приложението</p>
                                <p class="lang-en">Select preferred language</p>
                            </div>
                            <select id="language-select">
                                <option value="bg" selected>Български</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Банер за инсталиране на PWA -->
    <div class="install-banner" id="installBanner">
        <div class="install-banner-content">
            <div class="install-banner-icon">
                <i class="fas fa-parking"></i>
            </div>
            <div class="install-banner-text">
                <h4 class="lang-bg">Инсталирай Parkly</h4>
                <h4 class="lang-en">Install Parkly</h4>
                <p class="lang-bg">Добави на началния екран за бърз достъп</p>
                <p class="lang-en">Add to home screen for quick access</p>
            </div>
        </div>
        <div class="install-banner-actions">
            <button class="install-banner-btn" id="installBtn"><span class="lang-bg">Инсталирай</span><span class="lang-en">Install</span></button>
            <button class="install-banner-close" id="closeInstallBanner">&times;</button>
        </div>
    </div>
    
    <!-- Балонче за контакти -->
    <div class="contact-bubble" id="contactBubble">
        <i class="fas fa-headset"></i>
    </div>
    
    <!-- Модален прозорец за контакти -->
    <div class="contact-modal" id="contactModal">
        <div class="modal-header">
            <h3><i class="fas fa-headset"></i> <span class="lang-bg">Свържете се с нас</span><span class="lang-en">Contact Us</span></h3>
            <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
            <form class="contact-form" id="contactForm">
                <textarea class="lang-bg" placeholder="Напишете вашето съобщение тук..." required></textarea>
                <textarea class="lang-en" placeholder="Write your message here..." required></textarea>
                <button type="submit" class="btn btn-block">
                    <i class="fas fa-paper-plane"></i> <span class="lang-bg">Изпрати съобщение</span><span class="lang-en">Send message</span>
                </button>
            </form>

        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // ===== Firebase конфигурация =====
        const firebaseConfig = {
            databaseURL: "https://esp32-5d620-default-rtdb.firebaseio.com/"
        };
        
        // Инициализиране на Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ===== PWA Инсталация =====
        let deferredPrompt;
        const installBanner = document.getElementById('installBanner');
        const installBtn = document.getElementById('installBtn');
        const closeInstallBanner = document.getElementById('closeInstallBanner');

        // Проверка дали вече сме скривали банера
        if (!localStorage.getItem('installBannerClosed')) {
            window.addEventListener('beforeinstallprompt', (e) => {
                // Предотвратяване на автоматичното показване на мини-инфобара
                e.preventDefault();
                // Запазване на събитието за по-късна употреба
                deferredPrompt = e;
                // Показване на банера
                installBanner.style.display = 'flex';
            });
        }

        // Бутон за инсталиране
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            // Показване на инсталационния промпт
            deferredPrompt.prompt();
            
            // Изчакване на потребителския избор
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`Потребителски избор: ${outcome}`);
            
            // Нулиране на променливата
            deferredPrompt = null;
            
            // Скриване на банера
            installBanner.style.display = 'none';
        });

        // Затваряне на банера
        closeInstallBanner.addEventListener('click', () => {
            installBanner.style.display = 'none';
            localStorage.setItem('installBannerClosed', 'true');
        });

        // Проверка за офлайн режим
        window.addEventListener('online', () => {
            console.log('Приложението е онлайн');
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', () => {
            console.log('Приложението е офлайн');
            document.body.classList.add('offline');
            // Можете да покажете известие за офлайн режим
            if (typeof showNotification === 'function') {
                showNotification('Вие сте в офлайн режим. Някои функции може да не работят.', 'warning');
            }
        });

        // Регистрация на service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker регистриран успешно:', registration.scope);
                        
                        // Проверка за обновявания
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('Нов Service Worker се инсталира...');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Нов съдържание е налично
                                    if (confirm('Нова версия на приложението е налична. Обновете сега?')) {
                                        newWorker.postMessage({ action: 'skipWaiting' });
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Грешка при регистрация на Service Worker:', error);
                    });
            });

            // Контрол на обновяването
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }

        // ===== Променливи за статусите =====
        let spot1Status = "ЗАРЕЖДАНЕ";
        let spot2Status = "ЗАРЕЖДАНЕ";
        let spot1Distance = -1;
        let spot2Distance = -1;
        let lastUpdateTime = null;
        
        // ===== Инициализиране на картата =====
        const centerLat = 42.8768;
        const centerLng = 25.3179;
        
        // Глобални променливи за картата и паркоместата
        let map = null;
        let parkingPolygons = [];
        let parkingLabels = [];
        
        // Функция за инициализиране на картата
        function initializeMap() {
            // Проверка дали картата вече е инициализирана
            if (map !== null) return;
            
            try {
                // Създаване на картата
                map = L.map('map').setView([centerLat, centerLng], 18.5);
                
                // Добавяне на стандартен OpenStreetMap слой
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 22
                }).addTo(map);
                
                // Създаване на паркоместата
                createParkingSpots();
                

                
                console.log("Картата е инициализирана успешно");
            } catch (error) {
                console.error("Грешка при инициализиране на картата:", error);
                // Опитай пак след 1 секунда
                setTimeout(initializeMap, 1000);
            }
        }
        
        // По-големи размери за паркоместата
        const parkingWidth = 3.0;
        const parkingLength = 6.0;
        const spaceBetween = 0.5;
        
        // Функция за преобразуване на метри в градуси
        function metersToDegrees(meters) {
            return meters / 111111;
        }
        
        // Цветове за различните места
        const colors = {
            disabledEmpty: '#0066cc',
            disabledOccupied: '#b71c1c',
            regularEmpty: '#34a853',
            regularOccupied: '#ea4335'
        };
        
        // Създаване на 3 паркоместа
        function createParkingSpots() {
            if (!map) return;
            
            parkingPolygons = [];
            parkingLabels = [];
            
            for (let i = 0; i < 3; i++) {
                const offsetLng = metersToDegrees(i * (parkingWidth + spaceBetween));
                const totalWidth = 3 * parkingWidth + 2 * spaceBetween;
                const centerOffset = metersToDegrees(totalWidth / 2);
                
                const spotLat = centerLat;
                const spotLng = centerLng + offsetLng - centerOffset;
                
                const halfWidth = metersToDegrees(parkingWidth) / 2;
                const halfLength = metersToDegrees(parkingLength) / 2;
                
                // Ъглите на правоъгълника
                const corners = [
                    [spotLat - halfLength, spotLng - halfWidth],
                    [spotLat - halfLength, spotLng + halfWidth],
                    [spotLat + halfLength, spotLng + halfWidth],
                    [spotLat + halfLength, spotLng - halfWidth]
                ];
                
                // Определяне на цвета според статуса и типа място
                let fillColor;
                if (i === 0) { // Място за инвалиди
                    fillColor = spot1Status === "ЗАЕТО" ? colors.disabledOccupied : 
                               spot1Status === "ПРАЗНО" ? colors.disabledEmpty : colors.disabledEmpty;
                } else if (i === 1) { // Обикновено място със сензор
                    fillColor = spot2Status === "ЗАЕТО" ? colors.regularOccupied : 
                               spot2Status === "ПРАЗНО" ? colors.regularEmpty : colors.regularEmpty;
                } else { // Място 3 - демо
                    fillColor = colors.regularEmpty;
                }
                
                // Създаване на паркомястото
                const parkingSpace = L.polygon(corners, {
                    color: '#ffffff',
                    fillColor: fillColor,
                    fillOpacity: 0.8,
                    weight: 2
                }).addTo(map);
                
                parkingPolygons.push(parkingSpace);
                
                // Добавяне на номер с икона
                let labelHtml;
                if (i === 0) {
                    labelHtml = '<div style="background: white; color: ' + fillColor + '; font-weight: 700; font-size: 16px; width: 44px; height: 44px; border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 3px solid ' + fillColor + '; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-family: \'Segoe UI\', sans-serif; line-height: 1.2; background: rgba(255,255,255,0.98);"><span style="font-size: 12px;">' + (i + 1) + '</span><i class="fas fa-wheelchair" style="font-size: 18px;"></i></div>';
                } else {
                    labelHtml = '<div style="background: white; color: ' + fillColor + '; font-weight: 700; font-size: 18px; width: 38px; height: 38px; border-radius: 30px; display: flex; align-items: center; justify-content: center; border: 3px solid ' + fillColor + '; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-family: \'Segoe UI\', sans-serif; background: rgba(255,255,255,0.98);">' + (i + 1) + '</div>';
                }
                
                L.marker([spotLat, spotLng], {
                    icon: L.divIcon({
                        className: 'parking-label',
                        html: labelHtml,
                        iconSize: i === 0 ? [44, 44] : [38, 38],
                        iconAnchor: i === 0 ? [22, 22] : [19, 19]
                    })
                }).addTo(map);
                
                // Информация при клик
                let statusText = spot1Status;
                if (i === 1) statusText = spot2Status;
                else if (i === 2) statusText = "СВОБОДНО";
                
                let popupContent = '<div style="text-align: center; min-width: 220px;"><div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;"><div style="background: ' + fillColor + '; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px;">' + (i + 1) + '</div>' + (i === 0 ? '<i class="fas fa-wheelchair" style="color: #0066cc; font-size: 24px;"></i>' : '') + '</div><h3 style="margin: 0 0 8px; color: #1a2639; font-weight: 600;">Паркомясто ' + (i + 1) + '</h3>';
                
                if (i === 0) {
                    popupContent += '<p style="margin: 0 0 8px; font-size: 14px; color: #0066cc; font-weight: 600; background: #e3f2fd; padding: 4px 12px; border-radius: 30px; display: inline-block;">✦ За хора с увреждания ✦</p>';
                }
                
                popupContent += '<p style="margin: 0 0 12px; font-size: 13px; color: #5a6a7a;"><i class="fas fa-map-marker-alt" style="color: #ea4335;"></i> ул. "Епископ Софроний", Габрово</p><div style="text-align: left; font-size: 13px; background: #f8f9fa; padding: 12px; border-radius: 12px;"><div style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px;"><i class="fas fa-circle" style="color: ' + fillColor + '; font-size: 10px;"></i><strong>Статус:</strong> <span style="color: ' + fillColor + '; font-weight: 700;">' + statusText + '</span></div>';
                
                if (i === 0) {
                    popupContent += '<div style="display: flex; align-items: center; gap: 8px;"><i class="fas fa-ruler"></i><strong>Разстояние:</strong> ' + spot1Distance + ' см</div>';
                }
                if (i === 1) {
                    popupContent += '<div style="display: flex; align-items: center; gap: 8px;"><i class="fas fa-ruler"></i><strong>Разстояние:</strong> ' + spot2Distance + ' см</div>';
                }
                
                popupContent += '</div></div>';
                
                parkingSpace.bindPopup(popupContent);
            }
        }
        
        // ===== Firebase слушатели =====
        function setupFirebaseListeners() {
            // Слушател за място 1 (инвалиди)
            database.ref('parking/spot1').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    spot1Distance = data.distance || -1;
                    spot1Status = data.status || "ГРЕШКА";
                    
                    // Актуализиране на UI
                    updateSpotStatus(1, spot1Status, spot1Distance);
                    if (map && parkingPolygons.length > 0) {
                        updateMapColors();
                    }
                    updateLastUpdateTime();
                    updateFreeSpotsCount();
                }
            });
            
            // Слушател за място 2
            database.ref('parking/spot2').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    spot2Distance = data.distance || -1;
                    spot2Status = data.status || "ГРЕШКА";
                    
                    // Актуализиране на UI
                    updateSpotStatus(2, spot2Status, spot2Distance);
                    if (map && parkingPolygons.length > 0) {
                        updateMapColors();
                    }
                    updateLastUpdateTime();
                    updateFreeSpotsCount();
                }
            });
            
            console.log("Firebase слушатели са активирани");
        }
        
        // ===== UI функции =====
        function updateSpotStatus(spotNumber, status, distance) {
            const statusElement = document.getElementById('status' + spotNumber);
            if (!statusElement) return;
            
            // Определяне на класа и иконата за статус
            let statusClass = '';
            let icon = '';
            
            if (spotNumber === 1) {
                if (status === "ЗАЕТО") {
                    statusClass = "status-disabled-occupied";
                    icon = '<i class="fas fa-times-circle"></i>';
                } else if (status === "ПРАЗНО") {
                    statusClass = "status-disabled-empty";
                    icon = '<i class="fas fa-check-circle"></i>';
                } else {
                    statusClass = "status-pending";
                    icon = '<i class="fas fa-spinner fa-spin"></i>';
                }
            } else {
                if (status === "ЗАЕТО") {
                    statusClass = "status-occupied";
                    icon = '<i class="fas fa-times-circle"></i>';
                } else if (status === "ПРАЗНО") {
                    statusClass = "status-empty";
                    icon = '<i class="fas fa-check-circle"></i>';
                } else {
                    statusClass = "status-pending";
                    icon = '<i class="fas fa-spinner fa-spin"></i>';
                }
            }
            
            // Актуализиране на текста според езика
            const currentLang = document.body.getAttribute('data-lang') || 'bg';
            let statusText = status;
            
            if (currentLang === 'en') {
                if (status === "ЗАЕТО") statusText = "OCCUPIED";
                else if (status === "ПРАЗНО") statusText = "FREE";
                else if (status === "ЗАРЕЖДАНЕ") statusText = "LOADING";
                else if (status === "ГРЕШКА") statusText = "ERROR";
            }
            
            statusElement.innerHTML = icon + ' ' + statusText;
            statusElement.className = 'status-value ' + statusClass;
            
            // Добавяне на tooltip с разстояние
            if (distance > 0) {
                statusElement.title = (currentLang === 'bg' ? 'Разстояние: ' : 'Distance: ') + distance + ' cm';
            }
        }
        
        function updateMapColors() {
            if (!map || parkingPolygons.length === 0) return;
            
            for (let i = 0; i < parkingPolygons.length; i++) {
                let fillColor;
                
                if (i === 0) {
                    fillColor = spot1Status === "ЗАЕТО" ? colors.disabledOccupied : 
                               spot1Status === "ПРАЗНО" ? colors.disabledEmpty : colors.disabledEmpty;
                } else if (i === 1) {
                    fillColor = spot2Status === "ЗАЕТО" ? colors.regularOccupied : 
                               spot2Status === "ПРАЗНО" ? colors.regularEmpty : colors.regularEmpty;
                } else {
                    fillColor = colors.regularEmpty;
                }
                
                parkingPolygons[i].setStyle({ fillColor: fillColor });
            }
        }
        
        function updateFreeSpotsCount() {
            let free = 1; // Място 3 винаги свободно
            
            if (spot1Status === "ПРАЗНО") free++;
            if (spot2Status === "ПРАЗНО") free++;
            
            const freeSpotsElement = document.getElementById('freeSpots');
            if (freeSpotsElement) {
                freeSpotsElement.textContent = free;
            }
        }
        
        function updateLastUpdateTime() {
            lastUpdateTime = new Date();
            const timeString = lastUpdateTime.toLocaleTimeString('bg-BG', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const lastUpdateElement = document.getElementById('lastUpdate');
            if (lastUpdateElement) {
                const currentLang = document.body.getAttribute('data-lang') || 'bg';
                const prefix = currentLang === 'bg' ? 'Последна актуализация: ' : 'Last update: ';
                lastUpdateElement.innerHTML = '<i class="far fa-clock"></i> ' + prefix + timeString;
            }
        }
        
        function manualRefresh() {
            const refreshBtn = document.querySelector('.controls button i');
            if (refreshBtn) {
                refreshBtn.className = 'fas fa-spinner fa-spin';
            }
            
            // Ръчно актуализиране на данните
            database.ref('parking').once('value').then((snapshot) => {
                const data = snapshot.val();
                if (data) {
                    if (data.spot1) {
                        spot1Distance = data.spot1.distance || -1;
                        spot1Status = data.spot1.status || "ГРЕШКА";
                        updateSpotStatus(1, spot1Status, spot1Distance);
                    }
                    if (data.spot2) {
                        spot2Distance = data.spot2.distance || -1;
                        spot2Status = data.spot2.status || "ГРЕШКА";
                        updateSpotStatus(2, spot2Status, spot2Distance);
                    }
                    if (map && parkingPolygons.length > 0) {
                        updateMapColors();
                    }
                    updateLastUpdateTime();
                    updateFreeSpotsCount();
                }
                if (refreshBtn) {
                    refreshBtn.className = 'fas fa-sync-alt';
                }
            }).catch((error) => {
                console.error("Грешка при ръчно актуализиране:", error);
                if (refreshBtn) {
                    refreshBtn.className = 'fas fa-exclamation-triangle';
                    setTimeout(() => {
                        refreshBtn.className = 'fas fa-sync-alt';
                    }, 2000);
                }
            });
        }
        
        // ===== Функция за тъмна/светла тема =====
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDarkTheme = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                const darkmodeToggle = document.getElementById('darkmode-toggle');
                if (darkmodeToggle) darkmodeToggle.checked = true;
            }
        }

        // ===== Функции за езикова поддръжка =====
        function setLanguage(lang) {
            document.body.setAttribute('data-lang', lang);
            localStorage.setItem('language', lang);
            
            // Актуализиране на статусите на паркоместата според езика
            updateSpotStatus(1, spot1Status, spot1Distance);
            updateSpotStatus(2, spot2Status, spot2Distance);
            
            // Актуализиране на времето за последна актуализация
            updateLastUpdateTime();
            
            // Актуализиране на заглавието на страницата
            const pageTitle = document.getElementById('page-title');
            const activePage = document.querySelector('.page.active');
            if (activePage) {
                const pageId = activePage.id.replace('-page', '');
                const pageNames = {
                    'map': lang === 'bg' ? 'Карта на паркингите' : 'Parking Map',
                    'favorites': lang === 'bg' ? 'Любими места' : 'Favorites',
                    'profile': lang === 'bg' ? 'Моят профил' : 'My Profile',
                    'login': lang === 'bg' ? 'Вход в системата' : 'Login',
                    'register': lang === 'bg' ? 'Регистрация' : 'Register',
                    'settings': lang === 'bg' ? 'Настройки' : 'Settings'
                };
                pageTitle.textContent = pageNames[pageId];
            }
            
            console.log('Езикът е сменен на:', lang);
        }

        function loadLanguage() {
            const savedLanguage = localStorage.getItem('language') || 'bg';
            setLanguage(savedLanguage);
            
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.value = savedLanguage;
            }
        }
        
        // ===== Функции за навигация и любими =====
        
        // Инициализация на приложението
        document.addEventListener('DOMContentLoaded', function() {
            // Зареждане на запазената тема
            loadTheme();
            
            // Зареждане на запазения език
            loadLanguage();
            
            // Инициализиране на картата
            setTimeout(function() {
                initializeMap();
            }, 200);
            
            // Настройка на Firebase слушатели
            setupFirebaseListeners();
            
            // Първоначално ръчно зареждане на данни
            setTimeout(manualRefresh, 1500);
            
            // Генериране на любими паркинги
            generateFavorites();
            
            // Навигация между страниците
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            const pageTitle = document.getElementById('page-title');
            
            navItems.forEach(function(item) {
                item.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    
                    // Промяна на активния елемент в навигацията
                    navItems.forEach(function(nav) {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Показване на съответната страница
                    pages.forEach(function(page) {
                        page.classList.remove('active');
                        if (page.id === pageId + '-page') {
                            page.classList.add('active');
                            
                            // Промяна на заглавието според езика
                            const currentLang = document.body.getAttribute('data-lang') || 'bg';
                            const pageNames = {
                                'map': currentLang === 'bg' ? 'Карта на паркингите' : 'Parking Map',
                                'favorites': currentLang === 'bg' ? 'Любими места' : 'Favorites',
                                'profile': currentLang === 'bg' ? 'Моят профил' : 'My Profile',
                                'login': currentLang === 'bg' ? 'Вход в системата' : 'Login',
                                'register': currentLang === 'bg' ? 'Регистрация' : 'Register',
                                'settings': currentLang === 'bg' ? 'Настройки' : 'Settings'
                            };
                            pageTitle.textContent = pageNames[pageId];
                            
                            // Преоразмеряване на картата при показване
                            if (pageId === 'map') {
                                setTimeout(function() {
                                    if (map) map.invalidateSize();
                                }, 300);
                            }
                        }
                    });
                });
            });
            
            // Бутон за търсене
            document.getElementById('search-btn').addEventListener('click', function() {
                const searchTerm = document.getElementById('search-input').value;
                if (searchTerm.trim() !== '') {
                    const currentLang = document.body.getAttribute('data-lang') || 'bg';
                    alert(currentLang === 'bg' ? 'Търсене за: "' + searchTerm + '"' : 'Searching for: "' + searchTerm + '"');
                }
            });
            
            // Функция за генериране на любими паркинги
            function generateFavorites() {
                const favoritesList = document.getElementById('favorites-list');
                const favorites = [
                    {name: {bg: "ул. Епископ Софроний", en: "Ep. Sofroniy Street"}, address: {bg: "ул. Епископ Софроний, Габрово", en: "Ep. Sofroniy Street, Gabrovo"}, free: 3, total: 3, status: "free"},
                    {name: {bg: "Централен паркинг", en: "Central Parking"}, address: {bg: "ул. „Граф Игнатиев“ 2, София", en: "2 Graf Ignatiev Street, Sofia"}, free: 42, total: 158, status: "free"},
                    {name: {bg: "Паркинг Мол София", en: "Mall Sofia Parking"}, address: {bg: "бул. „Александър Малинов“ 31, София", en: "31 Alexander Malinov Blvd, Sofia"}, free: 15, total: 200, status: "free"},
                    {name: {bg: "Паркинг НДК", en: "NDK Parking"}, address: {bg: "бул. „Васил Левски“ 1, София", en: "1 Vasil Levski Blvd, Sofia"}, free: 0, total: 100, status: "busy"}
                ];
                
                favoritesList.innerHTML = '';
                
                favorites.forEach(function(favorite) {
                    const statusClass = favorite.status === 'free' ? 'status-free' : 'status-busy';
                    const statusTextBg = favorite.status === 'free' ? 'Свободни места' : 'Няма свободни места';
                    const statusTextEn = favorite.status === 'free' ? 'Available' : 'No available spots';
                    
                    const card = document.createElement('div');
                    card.className = 'favorite-card';
                    card.innerHTML = `
                        <div class="favorite-header">
                            <div class="favorite-name lang-bg">${favorite.name.bg}</div>
                            <div class="favorite-name lang-en">${favorite.name.en}</div>
                            <div class="favorite-status ${statusClass} lang-bg">${statusTextBg}</div>
                            <div class="favorite-status ${statusClass} lang-en">${statusTextEn}</div>
                        </div>
                        <p><i class="fas fa-map-marker-alt"></i> <span class="lang-bg">${favorite.address.bg}</span><span class="lang-en">${favorite.address.en}</span></p>
                        <p><i class="fas fa-car"></i> <span class="lang-bg">Свободни: ${favorite.free} / ${favorite.total}</span><span class="lang-en">Free: ${favorite.free} / ${favorite.total}</span></p>
                        <button class="btn" style="margin-top: 10px; width: 100%;"><i class="fas fa-directions"></i> <span class="lang-bg">Навигирай</span><span class="lang-en">Navigate</span></button>
                    `;
                    
                    favoritesList.appendChild(card);
                });
            }
            
            // Функционалност за балончето за контакти
            const contactBubble = document.getElementById('contactBubble');
            const contactModal = document.getElementById('contactModal');
            const closeModal = document.getElementById('closeModal');
            const contactForm = document.getElementById('contactForm');
            
            contactBubble.addEventListener('click', function() {
                contactModal.classList.toggle('active');
            });
            
            closeModal.addEventListener('click', function() {
                contactModal.classList.remove('active');
            });
            
            // Затваряне на модала при клик извън него
            document.addEventListener('click', function(event) {
                if (!contactModal.contains(event.target) && !contactBubble.contains(event.target) && contactModal.classList.contains('active')) {
                    contactModal.classList.remove('active');
                }
            });
            
            // Обработка на формата за контакти
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const message = this.querySelector('textarea').value;
                if (message.trim() !== '') {
                    const currentLang = document.body.getAttribute('data-lang') || 'bg';
                    alert(currentLang === 'bg' ? 'Вашето съобщение беше изпратено успешно! Ще се свържем с вас скоро.' : 'Your message was sent successfully! We will contact you soon.');
                    this.querySelector('textarea').value = '';
                    contactModal.classList.remove('active');
                }
            });
            
            // Предотвратяване на затварянето при клик вътре в модала
            contactModal.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Тъмна тема toggle
            const darkmodeToggle = document.getElementById('darkmode-toggle');
            if (darkmodeToggle) {
                darkmodeToggle.addEventListener('change', function() {
                    toggleTheme();
                });
            }
            
            // Език select
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    setLanguage(this.value);
                });
            }
        });
        
        console.log("Система за мониторинг на паркинг места - Габрово");
        console.log("Място 1: ЗА ИНВАЛИДИ (реални данни)");
        console.log("Място 2: Обикновено (реални данни)");
        console.log("Място 3: Демонстрационно място");
    </script>
</body>
</html>
